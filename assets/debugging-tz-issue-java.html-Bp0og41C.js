import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{a as l,h as n,e as i,b as t,g as o,o as g,r as d}from"./app-dowPD55j.js";const r="/images/blog/debugging-tz-issue-java/date-class-tostring.png",c="/images/blog/debugging-tz-issue-java/normalize_method.png",m="/images/blog/debugging-tz-issue-java/getDefaultRef.png",h="/images/blog/debugging-tz-issue-java/setDefaultZone.png",u="/images/blog/debugging-tz-issue-java/jni_call.png",p="/images/blog/debugging-tz-issue-java/findJavaTZ_md.png",b="/images/blog/debugging-tz-issue-java/getPlatFormTimeZoneID.png",f="/images/blog/debugging-tz-issue-java/timezone_cat.png",v="/images/blog/debugging-tz-issue-java/lstat_usage.png",z="/images/blog/debugging-tz-issue-java/final_output.png",y={};function j(k,e){const a=d("CaptionedImage");return g(),l("div",null,[e[0]||(e[0]=n('<h1 id="debugging-inconsistent-timezone-between-java-linux" tabindex="-1"><a class="header-anchor" href="#debugging-inconsistent-timezone-between-java-linux"><span>Debugging inconsistent timezone between Java &amp; Linux</span></a></h1><p>Have you ever noticed that in some cases, Java will not take the time zone which is configured in a server? This has serious impacts if the server handles scheduling tasks and runs them periodically.</p><p>Before diving deep down, let’s understand what is a time zone?</p><blockquote><p>Time Zones are geographical world globe division of 15 degree each, starting at Greenwich, England. It’s a uniform standard time for legal, commercial and social purposes.</p></blockquote><h2 id="the-issue" tabindex="-1"><a class="header-anchor" href="#the-issue"><span>The Issue</span></a></h2><h3 id="timezone-difference-between-the-system-and-java" tabindex="-1"><a class="header-anchor" href="#timezone-difference-between-the-system-and-java"><span>Timezone difference between the system and java</span></a></h3><p>While executing the below code, It will print the system time along with the timezone. I’ve added the output of the date command as well. Java code to print the current date using <code>new Date()</code></p>',7)),i(a,{src:"/images/blog/debugging-tz-issue-java/example-java-code.png",caption:"Example code"}),i(a,{src:"/images/blog/debugging-tz-issue-java/example-code-output.png",caption:"Output"}),e[1]||(e[1]=n('<br><p>Even though the system timezone is configured as <code>PST</code>, java prints the timezone as <code>GMT</code>.</p><h2 id="quick-fix" tabindex="-1"><a class="header-anchor" href="#quick-fix"><span>Quick fix</span></a></h2><ol><li>Set <code>user.timezonein</code> the command line as <code>-Duser.timezone=America/Los_Angeles</code></li><li>Set the environmental variable <code>TZ</code> to provide the timezone.</li></ol><p>The above solutions will work, but to understand and fix it once for all, read further for the <a href="#actual-fix">actual fix</a>. (All required source code links are embedded in the method names)</p><h2 id="detailed-explanation-the-why" tabindex="-1"><a class="header-anchor" href="#detailed-explanation-the-why"><span>Detailed Explanation: The Why?</span></a></h2><h3 id="backtracking-tostring-method-of-date-class" tabindex="-1"><a class="header-anchor" href="#backtracking-tostring-method-of-date-class"><span>Backtracking <code>toString()</code> method of <code>Date</code> class</span></a></h3><p>In the example java code, we call <code>System.out.println</code> of <code>new Date()</code>. We know that java calls an object’s <code>.toString()</code> method internally to provide the string representation of an object. Let’s take a look at the <code>toString</code> method of the <a href="https://hg.openjdk.java.net/jdk8/jdk8/jdk/file/tip/src/share/classes/java/util/Date.java#l999" target="_blank" rel="noopener noreferrer">Date class</a> in java.</p><p><img src="'+r+'" alt="toString method of date class" loading="lazy"></p><p>The timezone on Line:16is set by calling the <code>date.getZone()</code>. The variable date is initialized by calling the <code>normalize()</code> method.</p><p><img src="'+c+'" alt="BaseCalendar.Date normalize method" loading="lazy"></p><p>The timezone in <code>normalize</code> is set by calling the <code>TimeZone.getDefaultRef()</code> in <code>TimeZone.java</code> which then calls <code>setDefaultZone()</code> to get the system timezone.</p><p><img src="'+m+'" alt="getDefaultRef" loading="lazy"></p><p><img src="'+h+'" alt="setDefaultZone method" loading="lazy"></p><p>Now, let&#39;s break up and understand what the <code>setDefaultZone()</code> does.</p><ol><li>It checks for the zone by checking the <code>user.timezone</code> property (which we didn’t set via the command line).</li><li>If the <code>user.timezone</code> property is <code>null</code>, it gets the <code>java.home</code> property and calls the <code>getSystemTimeZoneID()</code> which is a native method.</li><li>Any <code>NULL</code> values will set the timezone to default GMT. (So, this is why the timezone is set to GMT!)</li></ol><p><img src="'+u+'" alt="Java native method to get the system timezone" loading="lazy"></p><p>Ignoring the unwanted details, let’s focus on what the <code>findJavaTZ_md()</code> does.</p><p><img src="'+p+'" alt="findJavaTZ_md method" loading="lazy"></p><p>Now, we can understand why the quick search solutions mentioned to set values for <code>user.timezone</code> and <code>TZ</code>! In our case, we didn’t set the TZ environmental variable which means <code>TZ = NULL</code>.</p><p>It calls <code>getPlatformTimeZoneID()</code> if <code>TZ</code> is <code>NULL</code>. (We’re about to reach a conclusion in the next step! Hang on..)</p><p><img src="'+b+'" alt="getPlatFormTimeZoneID method" loading="lazy"></p><p>As the comment says, it will check for <code>/etc/timezone</code> file which contains the system timezone information. I checked in my Ubuntu machine for the file and it&#39;s straightforward.</p><p><img src="'+f+'" alt="/etc/timezone example" loading="lazy"></p><p>If the file is not present, it checks <code>/etc/localtime</code> to obtain the timezone.</p><p><img src="'+v+'" alt="lstat usage" loading="lazy"></p><p>Here’s what happens in the above code.</p><ol><li>Get the file status of <code>/etc/localtime</code> using <a href="https://linux.die.net/man/2/lstat64" target="_blank" rel="noopener noreferrer">lstat</a></li><li>Check whether it&#39;s a symlink and read the symlink to obtain the timezone.</li></ol><p>For <code>lstat</code> to work as expected, it&#39;s required to have the executable <code>x</code> permission on the file (as stated in the manpage of lstat). In my case, the <code>/etc/localtime</code> file doesn’t have the executable permission set. Hence, it returns <code>NULL</code> taking the default timezone of <code>GMT</code>.</p>',29)),i(a,{src:"/images/blog/debugging-tz-issue-java/localtime_without_exec.png",caption:"/etc/localtime without executable permission"}),e[2]||(e[2]=t("br",null,null,-1)),e[3]||(e[3]=t("hr",null,null,-1)),e[4]||(e[4]=t("br",null,null,-1)),e[5]||(e[5]=t("h4",{id:"obtaining-timezone-via-symlink",tabindex:"-1"},[t("a",{class:"header-anchor",href:"#obtaining-timezone-via-symlink"},[t("span",null,"Obtaining Timezone via symlink")])],-1)),e[6]||(e[6]=t("p",null,[o("If the file has the required permission set, the output will be like the below one. After resolving the symlink, the zone info will be taken using the "),t("a",{href:"https://hg.openjdk.java.net/jdk/jdk/file/f91999057a5a/src/java.base/unix/native/libjava/TimeZone_md.c#l81",target:"_blank",rel:"noopener noreferrer"},"getZoneName"),o(" method.")],-1)),i(a,{src:"/images/blog/debugging-tz-issue-java/localtime_with_exec.png",caption:"/etc/localtime with executable permission"}),i(a,{src:"/images/blog/debugging-tz-issue-java/get_zone_name.png",caption:"getZoneName -- method"}),e[7]||(e[7]=n('<p>If the <code>/etc/localtimefile</code> is not a symlink, the <code>getPlatformTimeZoneID</code> method will try to open and read the file like <code>/etc/timezone</code>. As the last fallback, it will recursively iterate the <code>/usr/share/zoneinfodirectory</code> to find the timezone. When none of them works out, the timezone is set to <code>GMT</code> - the default!</p><hr><h3 id="actual-fix" tabindex="-1"><a class="header-anchor" href="#actual-fix"><span>Actual Fix</span></a></h3><p>I just had to create a symlink of <code>/etc/localtime</code> from <code>/usr/share/zoneinfo/America/Los_Angeles</code>.</p>',4)),i(a,{src:"/images/blog/debugging-tz-issue-java/symlink_creation.png",caption:"Symlink creation for /etc/localtime"}),e[8]||(e[8]=t("p",null,[o("After setting the symlink, running the "),t("code",null,"DateExample"),o(" program yields the expected result.")],-1)),e[9]||(e[9]=t("h3",{id:"final-output",tabindex:"-1"},[t("a",{class:"header-anchor",href:"#final-output"},[t("span",null,"Final Output")])],-1)),e[10]||(e[10]=t("p",null,[t("img",{src:z,alt:"image showing expected result",loading:"lazy"})],-1)),e[11]||(e[11]=t("p",null,"Thank you for reading! See you in the next post.",-1))])}const T=s(y,[["render",j],["__file","debugging-tz-issue-java.html.vue"]]),_=JSON.parse('{"path":"/blog/debugging-tz-issue-java.html","title":"Debugging inconsistent timezone between Java & Linux","lang":"en-US","frontmatter":{"date":"2022-03-10T00:00:00.000Z","lang":"en-US","title":"Debugging inconsistent timezone between Java & Linux","category":"linux","tag":["java","tz"],"head":[["meta",{"name":"keywords","content":"java linux timezone timezone_difference debugging tz"}],["meta",{"property":"og:url","content":"https://syogaraj.github.io/blog/debugging-tz-issue-java.html"}],["meta",{"property":"og:site_name","content":"Yogaraj.S"}],["meta",{"property":"og:title","content":"Debugging inconsistent timezone between Java & Linux"}],["meta",{"property":"og:description","content":"Debugging inconsistent timezone between Java & Linux Have you ever noticed that in some cases, Java will not take the time zone which is configured in a server? This has serious..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://syogaraj.github.io/images/blog/debugging-tz-issue-java/date-class-tostring.png"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2025-02-02T10:20:18.000Z"}],["meta",{"property":"article:tag","content":"java"}],["meta",{"property":"article:tag","content":"tz"}],["meta",{"property":"article:published_time","content":"2022-03-10T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2025-02-02T10:20:18.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Debugging inconsistent timezone between Java & Linux\\",\\"image\\":[\\"https://syogaraj.github.io/images/blog/debugging-tz-issue-java/date-class-tostring.png\\",\\"https://syogaraj.github.io/images/blog/debugging-tz-issue-java/normalize_method.png\\",\\"https://syogaraj.github.io/images/blog/debugging-tz-issue-java/getDefaultRef.png\\",\\"https://syogaraj.github.io/images/blog/debugging-tz-issue-java/setDefaultZone.png\\",\\"https://syogaraj.github.io/images/blog/debugging-tz-issue-java/jni_call.png\\",\\"https://syogaraj.github.io/images/blog/debugging-tz-issue-java/findJavaTZ_md.png\\",\\"https://syogaraj.github.io/images/blog/debugging-tz-issue-java/getPlatFormTimeZoneID.png\\",\\"https://syogaraj.github.io/images/blog/debugging-tz-issue-java/timezone_cat.png\\",\\"https://syogaraj.github.io/images/blog/debugging-tz-issue-java/lstat_usage.png\\",\\"https://syogaraj.github.io/images/blog/debugging-tz-issue-java/final_output.png\\"],\\"datePublished\\":\\"2022-03-10T00:00:00.000Z\\",\\"dateModified\\":\\"2025-02-02T10:20:18.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Yogaraj. S\\",\\"email\\":\\"yogarajsivaprakasam@gmail.com\\"}]}"]],"star":true,"description":"Debugging inconsistent timezone between Java & Linux Have you ever noticed that in some cases, Java will not take the time zone which is configured in a server? This has serious..."},"headers":[{"level":2,"title":"The Issue","slug":"the-issue","link":"#the-issue","children":[{"level":3,"title":"Timezone difference between the system and java","slug":"timezone-difference-between-the-system-and-java","link":"#timezone-difference-between-the-system-and-java","children":[]}]},{"level":2,"title":"Quick fix","slug":"quick-fix","link":"#quick-fix","children":[]},{"level":2,"title":"Detailed Explanation: The Why?","slug":"detailed-explanation-the-why","link":"#detailed-explanation-the-why","children":[{"level":3,"title":"Backtracking toString() method of Date class","slug":"backtracking-tostring-method-of-date-class","link":"#backtracking-tostring-method-of-date-class","children":[]},{"level":3,"title":"Actual Fix","slug":"actual-fix","link":"#actual-fix","children":[]},{"level":3,"title":"Final Output","slug":"final-output","link":"#final-output","children":[]}]}],"git":{"createdTime":1737820319000,"updatedTime":1738491618000,"contributors":[{"name":"yogaraj.s","username":"yogaraj.s","email":"yogarajsivaprakasam@gmail.com","commits":3,"url":"https://github.com/yogaraj.s"}]},"readingTime":{"minutes":2.89,"words":866},"filePathRelative":"blog/debugging-tz-issue-java.md","localizedDate":"March 10, 2022","excerpt":"\\n<p>Have you ever noticed that in some cases, Java will not take the time zone which is configured in a server? This has serious impacts if the server handles scheduling tasks and runs them periodically.</p>","autoDesc":true}');export{T as comp,_ as data};
